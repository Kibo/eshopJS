var ESHOP_JS=ESHOP_JS||{};ESHOP_JS.namespace=function(a){var b=a.split("."),c=ESHOP_JS;"ESHOP_JS"===b[0]&&(b=b.slice(1));for(var d=0;d<b.length;d+=1)"undefined"==typeof c[b[d]]&&(c[b[d]]={}),c=c[b[d]];return c},ESHOP_JS.namespace("modules"),ESHOP_JS.namespace("messages"),ESHOP_JS.utils=function(a,b){return{isTouchDevice:function(){return"ontouchstart"in b.documentElement},findParentByClass:function(a,b){for(var c=a;!c.classList.contains(b);)c=c.parentElement;return c}}}(window,document),ESHOP_JS.messages.en={POSTAGES:[{name:"Personal collection",price:0},{name:"Czech Post",price:80}],PAYMENT_METHODS:[{name:"Payment on branch",price:0},{name:"Cash on delivery",price:40},{name:"Payment in advance",price:0}],CURRENCY_BEFORE:"$",CURRENCY_AFTER:"",CART_HEADLINE:"Shopping cart",CART_REMOVE_BUTTON:"Remove",PRODUCT_TITLE_COLUMNT_NAME:"Product",PRODUCT_DETAILS_COLUMNT_NAME:"Details",PRODUCT_PRICE_COLUMNT_NAME:"Price",PRODUCT_COUNT_COLUMNT_NAME:"Count",PRODUCT_SUBTOTAL_COLUMNT_NAME:"Sub-Total",PRODUCT_EMPTY_MESSAGE:"There are not products yet.",POSTAGE:"Postage",TOTAL_PRICE:"Total price",SUMMARY_HEADLINE:"Summary",PAYMENT_HEADLINE:"Payment method",POSTAGES_HEADLINE:"Postages",DELIVERY_ADDRESS_HEADLINE:"Delivery address",DELIVERY_ADDRESS_FULL_NAME:"Full Name",DELIVERY_ADDRESS_ADDRESS_LINE:"Address Line",DELIVERY_ADDRESS_CITY:"City",DELIVERY_ADDRESS_ZIP:"Zip / Postal Code",DELIVERY_ADDRESS_EMAIL:"E-mail",DELIVERY_ADDRESS_PHONE:"Phone number"},ESHOP_JS.messages.cs={POSTAGES:[{name:"Česká pošta",price:80},{name:"Osobní převzetí",price:0}],PAYMENT_METHODS:[{name:"Dobírka",price:40},{name:"Hotovost",price:0}],CURRENCY_BEFORE:"",CURRENCY_AFTER:"Kč",CART_HEADLINE:"Nákupní košík",CART_REMOVE_BUTTON:"Odstranit",PRODUCT_TITLE_COLUMNT_NAME:"Produkt",PRODUCT_DETAILS_COLUMNT_NAME:"Detail",PRODUCT_PRICE_COLUMNT_NAME:"Cena",PRODUCT_COUNT_COLUMNT_NAME:"Počet",PRODUCT_SUBTOTAL_COLUMNT_NAME:"Mezi součet",PRODUCT_EMPTY_MESSAGE:"Zatím žádný produkt.",POSTAGE:"Poštovné",TOTAL_PRICE:"Celková cena",SUMMARY_HEADLINE:"Přehled",PAYMENT_HEADLINE:"Způsob platby",POSTAGES_HEADLINE:"Způsob doručení",DELIVERY_ADDRESS_HEADLINE:"Doručovací adresa",DELIVERY_ADDRESS_FULL_NAME:"Jméno a příjmení",DELIVERY_ADDRESS_ADDRESS_LINE:"Adresa",DELIVERY_ADDRESS_CITY:"Město",DELIVERY_ADDRESS_ZIP:"PSČ",DELIVERY_ADDRESS_EMAIL:"E-mail",DELIVERY_ADDRESS_PHONE:"Telefoní číslo"},ESHOP_JS.settings={PRODUCT_DOM_CLASS:"product",PRODUCT_TITLE_DOM_CLASS:"product-title",PRODUCT_PRICE_DOM_CLASS:"product-price",PRODUCT_BASE_PRICE_DOM_ATTRIBUTE:"data-base-price",PRODUCT_VARIATIONS_DOM_CLASS:"product-variations",PRODUCT_LINK_DOM_CLASS:"product-add-to-cart",REMOVE_FROM_CART_DOM_CLASS:"btn-remove",CART_DOM_ID:"cart",CHECKOUT_DOM_ID:"checkout",SUMMARY_DOM_ID:"summary",COUNT_OF_PRODUCTS_DOM_CLASS:"cart-products-count",CART_STORAGE_KEY:"ESHOP_JS",CART_CHANGE_EVENT_NAME:"cartchange",CHECKOUT_CHANGE_EVENT_NAME:"checkoutchange",POSTAGES_WRAPPER_DOM_CLASS:"postages",PAYMENTS_WRAPPER_DOM_CLASS:"payments"},ESHOP_JS.modules.pubsub=function(){var a={},b=-1;return{publish:function(b,c){if(!a[b])return!1;for(var d=a[b],e=d?d.length:0;e--;)d[e].func(c);return this},subscribe:function(c,d){a[c]||(a[c]=[]);var e=(++b).toString();return a[c].push({token:e,func:d}),e},unsubscribe:function(b){for(var c in a)if(a[c])for(var d=0,e=a[c].length;e>d;d++)if(a[c][d].token===b)return a[c].splice(d,1),b;return this}}}(),window.ESHOP_JS.templates={cart:'<table class="table table-striped table-bordered"><caption><%=ESHOP_JS.settings.messages.CART_HEADLINE%></caption><thead><tr><th><%=ESHOP_JS.settings.messages.PRODUCT_TITLE_COLUMNT_NAME%></th><th><%=ESHOP_JS.settings.messages.PRODUCT_DETAILS_COLUMNT_NAME%></th><th><%=ESHOP_JS.settings.messages.PRODUCT_PRICE_COLUMNT_NAME%></th><th><%=ESHOP_JS.settings.messages.PRODUCT_COUNT_COLUMNT_NAME%></th><th><%=ESHOP_JS.settings.messages.PRODUCT_SUBTOTAL_COLUMNT_NAME%></th><th>&nbsp;</th></tr></thead><tbody><% if( products.length === 0){%><tr><td colspan="6"><%=ESHOP_JS.settings.messages.PRODUCT_EMPTY_MESSAGE%></td></tr><% } %><% for (var idx = 0, len = products.length; idx < len; idx ++) { %><tr><td><%= products[idx].title %></td><td><%= products[idx].variations %></td><td><%=ESHOP_JS.settings.messages.CURRENCY_BEFORE%><%= products[idx].price %><%=ESHOP_JS.settings.messages.CURRENCY_AFTER%></td><td><input type="number" value="<%= products[idx].count %>" min="1" max="100" step="1" data-idx="<%=idx%>"></td><td><%=ESHOP_JS.settings.messages.CURRENCY_BEFORE%><%= products[idx].count * products[idx].price %><%=ESHOP_JS.settings.messages.CURRENCY_AFTER%></td><td><a href="#cart" class="btn btn-danger btn-xs btn-remove" title="<%=ESHOP_JS.settings.messages.CART_REMOVE_BUTTON%>" data-idx="<%=idx%>"><span class="glyphicon glyphicon-trash"></span> <%=ESHOP_JS.settings.messages.CART_REMOVE_BUTTON%></a></td></tr><% } %><tfoot><tr class="info"><th colspan="4"><%=ESHOP_JS.settings.messages.PRODUCT_SUBTOTAL_COLUMNT_NAME%></th><td colspan="2"><%=ESHOP_JS.settings.messages.CURRENCY_BEFORE%><%=ESHOP_JS.modules.cart.totalPrice()%><%=ESHOP_JS.settings.messages.CURRENCY_AFTER%></td></tr></tfoot></tbody></table>',checkout:'<!-- Wrapper for summary table --><div id="summary"></div><fieldset class="postages">  <legend><%=ESHOP_JS.settings.messages.POSTAGES_HEADLINE%></legend>        <% for(var idx = 0, len = settings.messages.POSTAGES.length; idx < len; idx++){%>  <div class="radio">  <label>      <input type="radio" name="postage" value="<%=settings.messages.POSTAGES[idx].name%>" data-price="<%=settings.messages.POSTAGES[idx].price%>" <%=idx === 0 ? \'checked\' : \'\'%>>    <%=settings.messages.POSTAGES[idx].name%>      </label></div><%}%></fieldset><fieldset class="payments">  <legend><%=ESHOP_JS.settings.messages.PAYMENT_HEADLINE%></legend>        <% for(var idx = 0, len = settings.messages.PAYMENT_METHODS.length; idx < len; idx++){%>  <div class="radio">  <label>    <input type="radio" name="payment" value="<%=settings.messages.PAYMENT_METHODS[idx].name%>" data-price="<%=settings.messages.PAYMENT_METHODS[idx].price%>" <%=idx === 0 ? \'checked\' : \'\'%>>    <%=settings.messages.PAYMENT_METHODS[idx].name%>      </label></div><%}%></fieldset>  <fieldset class="address">  <legend><%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_HEADLINE%></legend>    <div class="form-group">    <label for="fullname"><%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_FULL_NAME%></label>    <input name="fullname" type="text" class="form-control" placeholder="<%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_FULL_NAME%>" required>  </div>    <div class="form-group">    <label for="street"><%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_ADDRESS_LINE%></label>    <input name="street" type="text" class="form-control" placeholder="<%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_ADDRESS_LINE%>" required>  </div>    <div class="form-group">    <label for="city"><%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_CITY%></label>    <input name="city" type="text" class="form-control" placeholder="<%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_CITY%>" required>  </div>    <div class="form-group">    <label for="zip"><%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_ZIP%></label>    <input name="zip" type="text" class="form-control" placeholder="<%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_ZIP%>" required>  </div>    <div class="form-group">    <label for="email"><%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_EMAIL%></label>    <input name="email" type="email" class="form-control" placeholder="<%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_EMAIL%>" required>  </div>    <div class="form-group">    <label for="phone"><%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_PHONE%></label>    <input name="phone" type="tel" class="form-control" placeholder="<%=ESHOP_JS.settings.messages.DELIVERY_ADDRESS_PHONE%>" required>  </div> </fieldset>    ',summary:'<table class="table table-striped table-bordered"><caption><%=ESHOP_JS.settings.messages.SUMMARY_HEADLINE%></caption> <thead>  <tr><th><%=ESHOP_JS.settings.messages.PRODUCT_TITLE_COLUMNT_NAME%></th><th><%=ESHOP_JS.settings.messages.PRODUCT_DETAILS_COLUMNT_NAME%></th><th><%=ESHOP_JS.settings.messages.PRODUCT_PRICE_COLUMNT_NAME%></th><th><%=ESHOP_JS.settings.messages.PRODUCT_COUNT_COLUMNT_NAME%></th><th><%=ESHOP_JS.settings.messages.PRODUCT_SUBTOTAL_COLUMNT_NAME%></th></tr></thead><tbody><% if( products.length === 0){%><tr><td colspan="5"><%=ESHOP_JS.settings.messages.PRODUCT_EMPTY_MESSAGE%></td></tr><% } %><% for (var idx = 0, len = products.length; idx < len; idx ++) { %><tr><td><%= products[idx].title %></td><td><%= products[idx].variations %></td><td><%=ESHOP_JS.settings.messages.CURRENCY_BEFORE%><%= products[idx].price %><%=ESHOP_JS.settings.messages.CURRENCY_AFTER%></td><td><%= products[idx].count %></td><td><%=ESHOP_JS.settings.messages.CURRENCY_BEFORE%><%= products[idx].count * products[idx].price %><%=ESHOP_JS.settings.messages.CURRENCY_AFTER%></td></tr><% } %><tfoot><tr><th colspan="4"><%=ESHOP_JS.settings.messages.PRODUCT_SUBTOTAL_COLUMNT_NAME%></th><td colspan="1"><%=ESHOP_JS.settings.messages.CURRENCY_BEFORE%><%=summary.subTotal%><%=ESHOP_JS.settings.messages.CURRENCY_AFTER%></td></tr><tr><th colspan="4"><%=ESHOP_JS.settings.messages.POSTAGE%></th><td colspan="1"><%=ESHOP_JS.settings.messages.CURRENCY_BEFORE%><%=summary.totalPostagePrice%><%=ESHOP_JS.settings.messages.CURRENCY_AFTER%></td></tr><tr class="info"><th colspan="4"><%=ESHOP_JS.settings.messages.TOTAL_PRICE%></th><td colspan="1"><b><%=ESHOP_JS.settings.messages.CURRENCY_BEFORE%><%=summary.totalPrice%><%=ESHOP_JS.settings.messages.CURRENCY_AFTER%></b></td></tr></tfoot></tbody> </table><input type="hidden" name="cart" value="<%=ESHOP_JS.modules.cart.toString()%>" >'},ESHOP_JS.modules.storage=function(){function a(){try{return"sessionStorage"in window&&null!==window.sessionStorage}catch(a){return!1}}if(!a())throw{name:"UnsupportedAPI",message:"Your browser probably does not support SessionStorage"};return{get:function(a){var b=sessionStorage.getItem(a);return b?JSON.parse(b):{}},save:function(a,b){sessionStorage.setItem(a,JSON.stringify(b))}}}(),ESHOP_JS.modules.templateEngine=function(){return{compile:function(a){return new Function("data","var p=[];with( data ){ p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');} return p.join('');")}}}(),ESHOP_JS.modules.cart=function(a,b){function c(a){var b=!0,c=[];return{isValid:b,obj:a,errors:c}}function d(a,b){for(var c={result:!1,index:null},d=0,e=a.length;e>d;d++)if(b.title===a[d].title&&b.variations===a[d].variations&&b.price===a[d].price){c.result=!0,c.index=d;break}return c}function e(a){for(var b=a.querySelectorAll("input[type='number']"),c=0,d=b.length;d>c;c++)b[c].addEventListener("change",function(a){var b=a.target,c=n.get(m.CART_STORAGE_KEY).products;c[b.dataset.idx].count=b.value>=1?b.value:1,n.save(m.CART_STORAGE_KEY,{products:c}),ESHOP_JS.modules.pubsub.publish(m.CART_CHANGE_EVENT_NAME)},!1)}function f(a){for(var b=a.querySelectorAll("."+m.REMOVE_FROM_CART_DOM_CLASS),c=0,d=b.length;d>c;c++)b[c].addEventListener(k.isTouchDevice()?"touchstart":"mousedown",function(a){var b=n.get(m.CART_STORAGE_KEY).products;b.splice(a.target.dataset.idx,1),n.save(m.CART_STORAGE_KEY,{products:b}),ESHOP_JS.modules.pubsub.publish(m.CART_CHANGE_EVENT_NAME)},!1)}function g(a){for(var b=h(),c=0,d=a.length;d>c;c++)a[c].innerHTML=b}function h(){for(var a=0,b=n.get(m.CART_STORAGE_KEY).products,c=0,d=b.length;d>c;c++)a+=parseInt(b[c].count,10);return a}function i(){for(var a=0,b=n.get(m.CART_STORAGE_KEY).products,c=0,d=b.length;d>c;c++)a+=parseInt(b[c].count,10)*parseInt(b[c].price,10);return a}var j={products:[]},k=ESHOP_JS.utils,l=ESHOP_JS.modules.pubsub,m=ESHOP_JS.settings,n=ESHOP_JS.modules.storage,o=ESHOP_JS.modules.templateEngine.compile(ESHOP_JS.templates.cart);return n.get(m.CART_STORAGE_KEY).products||n.save(m.CART_STORAGE_KEY,j),{add:function(a){var b=c(a);if(!b.isValid)throw{name:"ValidationException",message:b.message.join(", "),obj:a};var e=n.get(m.CART_STORAGE_KEY).products,f=d(e,a);f.result?e[f.index].count++:e.push(a),n.save(m.CART_STORAGE_KEY,{products:e}),l.publish(m.CART_CHANGE_EVENT_NAME)},remove:function(a){var b=n.get(m.CART_STORAGE_KEY).products,c=d(b,a);"null"!==c.index&&b.splice(c.index,1),n.save(m.CART_STORAGE_KEY,{products:b}),l.publish(m.CART_CHANGE_EVENT_NAME)},reset:function(){n.save(m.CART_STORAGE_KEY,j),l.publish(m.CART_CHANGE_EVENT_NAME)},count:function(){return h()},totalPrice:function(){return i()},refresh:function(){g(b.querySelectorAll("."+m.COUNT_OF_PRODUCTS_DOM_CLASS));var a=b.getElementById(m.CART_DOM_ID);if(a){var c=n.get(m.CART_STORAGE_KEY);c.settings=ESHOP_JS.settings,a.innerHTML=o(c),e(a),f(a)}},toString:function(){return JSON.stringify(n.get(m.CART_STORAGE_KEY))},init:function(){this.refresh(),l.subscribe(m.CART_CHANGE_EVENT_NAME,function(){ESHOP_JS.modules.cart.refresh()})}}}(window,document),ESHOP_JS.modules.product=function(a,b){function c(a){var b=parseInt(a.querySelector("["+i.PRODUCT_BASE_PRICE_DOM_ATTRIBUTE+"]").getAttribute(i.PRODUCT_BASE_PRICE_DOM_ATTRIBUTE));return b+f(a)}function d(a){for(var b=a.querySelectorAll("."+i.PRODUCT_VARIATIONS_DOM_CLASS),c=[],d=[],e=0,f=b.length;f>e;e++)switch(b[e].tagName){case"SELECT":c.push(b[e].options[b[e].selectedIndex].text),d.push(parseInt(b[e].options[b[e].selectedIndex].value,10));break;default:throw{name:"UnsupportedVariationsElementException",message:"Variation uses a unsupported tag: "+b[e].tagName}}return{texts:c,prices:d}}function e(a){return d(a).texts.join(", ")}function f(a){var b=d(a).prices;return 0===b.length?0:b.reduce(function(a,b){return a+b})}function g(a){for(var b=a.querySelectorAll("."+i.PRODUCT_LINK_DOM_CLASS),c=0,d=b.length;d>c;c++)b[c].addEventListener(j.isTouchDevice()?"touchstart":"mousedown",function(a){var b=ESHOP_JS.utils.findParentByClass(a.target,ESHOP_JS.settings.PRODUCT_DOM_CLASS);ESHOP_JS.modules.cart.add(ESHOP_JS.modules.product.getData(b)),a.preventDefault()},!1)}function h(a){for(var b=a.querySelectorAll("."+i.PRODUCT_VARIATIONS_DOM_CLASS),c=0,d=b.length;d>c;c++)"SELECT"===b[c].tagName&&b[c].addEventListener("change",function(a){var b=ESHOP_JS.utils.findParentByClass(a.target,ESHOP_JS.settings.PRODUCT_DOM_CLASS);ESHOP_JS.modules.product.refreshPrice(b)},!1)}{var i=ESHOP_JS.settings,j=ESHOP_JS.utils;ESHOP_JS.modules.cart}return{getData:function(a){return{title:a.querySelector("."+i.PRODUCT_TITLE_DOM_CLASS).innerHTML,variations:e(a),count:1,price:c(a)}},setHandlers:function(a){g(a),h(a)},refreshPrice:function(a){for(var b=a.querySelectorAll("."+i.PRODUCT_PRICE_DOM_CLASS),d=c(a),e=0,f=b.length;f>e;e++)b[e].innerHTML=d},init:function(){for(var a=b.querySelectorAll("."+i.PRODUCT_DOM_CLASS),c=0,d=a.length;d>c;c++)this.refreshPrice(a[c]),this.setHandlers(a[c])}}}(window,document),ESHOP_JS.modules.checkout=function(a,b){function c(a){for(var b=a.querySelectorAll('input[type="radio"]'),c=0,f=b.length;f>c;c++)b[c].addEventListener("change",function(){d.publish(e.CHECKOUT_CHANGE_EVENT_NAME)},!1)}var d=(ESHOP_JS.utils,ESHOP_JS.modules.pubsub),e=ESHOP_JS.settings,f=ESHOP_JS.modules.storage,g=ESHOP_JS.modules.templateEngine.compile(ESHOP_JS.templates.checkout);return{show:function(){var a=b.getElementById(e.CHECKOUT_DOM_ID);if(a){var d=f.get(e.CART_STORAGE_KEY);d.settings=ESHOP_JS.settings,a.innerHTML=g(d),c(b.getElementById(e.CHECKOUT_DOM_ID))}},init:function(){this.show()}}}(window,document),ESHOP_JS.modules.summary=function(a,b){function c(a){return parseInt(a.querySelector("."+f.POSTAGES_WRAPPER_DOM_CLASS+' input[type="radio"]:checked').dataset.price,10)}function d(a){return parseInt(a.querySelector("."+f.PAYMENTS_WRAPPER_DOM_CLASS+' input[type="radio"]:checked').dataset.price,10)}var e=ESHOP_JS.modules.pubsub,f=ESHOP_JS.settings,g=ESHOP_JS.modules.storage,h=ESHOP_JS.modules.cart,i=ESHOP_JS.modules.templateEngine.compile(ESHOP_JS.templates.summary);return{refresh:function(){var a=b.getElementById(f.SUMMARY_DOM_ID);if(a){var e=g.get(f.CART_STORAGE_KEY);e.settings=ESHOP_JS.settings,e.summary={},e.summary.subTotal=h.totalPrice(),e.summary.totalPostagePrice=h.totalPrice()?c(b.getElementById(f.CHECKOUT_DOM_ID))+d(b.getElementById(f.CHECKOUT_DOM_ID)):0,e.summary.totalPrice=h.totalPrice()?h.totalPrice()+e.summary.totalPostagePrice:0,a.innerHTML=i(e)}},init:function(){this.refresh(),e.subscribe(f.CART_CHANGE_EVENT_NAME,function(){ESHOP_JS.modules.summary.refresh()}),e.subscribe(f.CHECKOUT_CHANGE_EVENT_NAME,function(){ESHOP_JS.modules.summary.refresh()})}}}(window,document),ESHOP_JS.init=function(a){ESHOP_JS.settings.messages=ESHOP_JS.messages[a||"en"],ESHOP_JS.modules.product.init(),ESHOP_JS.modules.cart.init(),ESHOP_JS.modules.checkout.init(),ESHOP_JS.modules.summary.init()};